<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Number Validator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #9fef00 0%, #c5e063 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            flex: 1;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 20px;
            padding: 15px;
            font-size: 0.85em;
        }

        .footer a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            transition: border-color 0.2s;
        }

        .footer a:hover {
            border-bottom-color: rgba(255, 255, 255, 0.9);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #9fef00;
        }

        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .input-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .input-counter {
            font-weight: 600;
            color: #333;
        }

        .tier-indicator {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
            text-align: right;
            line-height: 1.4;
        }

        .tier-label {
            font-size: 0.85em;
            display: block;
            opacity: 0.9;
        }

        .tier-target {
            font-size: 1.1em;
            display: block;
            margin-top: 2px;
        }

        .tier-insufficient {
            background: #f8d7da;
            color: #721c24;
        }

        .tier-minimal {
            background: #fff3cd;
            color: #856404;
        }

        .tier-limited {
            background: #d1ecf1;
            color: #0c5460;
        }

        .tier-good {
            background: #d4edda;
            color: #155724;
        }

        .tier-excellent {
            background: #e8f5d8;
            color: #2d5016;
            font-weight: bold;
        }

        .guidance-box {
            margin-top: 15px;
            padding: 12px;
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .guidance-box strong {
            color: #1976D2;
        }

        .tier-chart {
            margin-top: 15px;
            margin-bottom: 20px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .tier-chart-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.85em;
        }

        .tier-row {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            margin: 4px 0;
            border-radius: 4px;
            background: white;
            border: 2px solid transparent;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .tier-row.active {
            border: 2px solid #9fef00;
            background: #f8ffe8;
            box-shadow: 0 2px 8px rgba(159, 239, 0, 0.2);
        }

        .tier-row.completed {
            opacity: 0.6;
        }

        .tier-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.75em;
            margin-right: 10px;
            min-width: 70px;
            text-align: center;
        }

        .tier-badge.badge-insufficient { background: #f8d7da; color: #721c24; }
        .tier-badge.badge-minimal { background: #fff3cd; color: #856404; }
        .tier-badge.badge-limited { background: #d1ecf1; color: #0c5460; }
        .tier-badge.badge-good { background: #d4edda; color: #155724; }
        .tier-badge.badge-excellent { background: #e8f5d8; color: #2d5016; }

        .tier-description {
            flex: 1;
            color: #495057;
            line-height: 1.3;
        }

        .tier-requirement {
            font-weight: 600;
            color: #212529;
        }

        .tier-status {
            font-weight: 700;
            color: #9fef00;
            margin-left: 8px;
            font-size: 0.9em;
        }

        button {
            background: linear-gradient(135deg, #9fef00 0%, #c5e063 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(159, 239, 0, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #results {
            margin-top: 30px;
            padding: 25px;
            border-radius: 8px;
            display: none;
        }

        #results.valid {
            background: #e8f5d8;
            border: 2px solid #9fef00;
        }

        #results.invalid {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .result-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
        }

        .result-label {
            font-weight: 600;
            color: #333;
        }

        .quality-score {
            font-size: 2em;
            font-weight: bold;
            margin: 15px 0;
        }

        .quality-bar {
            width: 100%;
            height: 30px;
            background: #eee;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #9fef00 100%);
            transition: width 0.5s ease;
            width: 0%; /* Start at 0%, will be updated by JavaScript */
        }

        .loading {
            text-align: center;
            color: #666;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Random Number Validator</h1>
        <p class="subtitle">Test the quality of your random number sequences</p>

        <form id="validationForm">
            <div class="form-group">
                <label for="numbers">Enter your random numbers:</label>
                <textarea
                    id="numbers"
                    name="numbers"
                    rows="5"
                    placeholder="Example: 42, 17, 89, 3, 56, 91, 23, 67"
                    required
                ></textarea>
                <div class="help-text">Enter positive integers (use any delimiter: commas, spaces, newlines, etc.)</div>

                <div class="input-stats">
                    <div class="input-counter">
                        <span id="numberCount">0</span> numbers (<span id="bitCount">0</span> bits)
                    </div>
                    <div id="tierIndicator" class="tier-indicator tier-insufficient">
                        Too Small
                    </div>
                </div>

                <div id="guidanceBox" class="guidance-box" style="display: none;">
                    <strong>Expected Results:</strong>
                    <div id="guidanceText"></div>
                </div>
            </div>

            <button type="submit">Validate Numbers</button>
            <div class="help-text" style="margin-top: 10px; text-align: center;">
                Uses comprehensive NIST Statistical Test Suite for validation
            </div>

            <div class="tier-chart">
                <div class="tier-chart-title">üìä Test Coverage Tiers</div>

                <div id="tier0" class="tier-row">
                    <div class="tier-badge badge-insufficient">Too Small</div>
                    <div class="tier-description">
                        <span class="tier-requirement">0-3 numbers</span> ¬∑ No NIST tests
                    </div>
                    <div class="tier-status" style="display: none;">‚Üê YOU ARE HERE</div>
                </div>

                <div id="tier1" class="tier-row">
                    <div class="tier-badge badge-minimal">Minimal</div>
                    <div class="tier-description">
                        <span class="tier-requirement">4-31 numbers</span> ¬∑ Limited NIST
                    </div>
                    <div class="tier-status" style="display: none;">‚Üê YOU ARE HERE</div>
                </div>

                <div id="tier2" class="tier-row">
                    <div class="tier-badge badge-limited">Partial</div>
                    <div class="tier-description">
                        <span class="tier-requirement">32-124 numbers</span> ¬∑ Some tests
                    </div>
                    <div class="tier-status" style="display: none;">‚Üê YOU ARE HERE</div>
                </div>

                <div id="tier3" class="tier-row">
                    <div class="tier-badge badge-good">Good</div>
                    <div class="tier-description">
                        <span class="tier-requirement">125-312 numbers</span> ¬∑ Most tests
                    </div>
                    <div class="tier-status" style="display: none;">‚Üê YOU ARE HERE</div>
                </div>

                <div id="tier4" class="tier-row">
                    <div class="tier-badge badge-excellent">Excellent</div>
                    <div class="tier-description">
                        <span class="tier-requirement">313+ numbers</span> ¬∑ Full coverage
                    </div>
                    <div class="tier-status" style="display: none;">‚Üê YOU ARE HERE</div>
                </div>
            </div>
        </form>

        <div class="loading" id="loading">
            <p>Running comprehensive NIST statistical analysis...</p>
            <p style="margin-top: 10px; font-size: 0.9em;">This may take a few seconds</p>
        </div>

        <div id="results">
            <div class="result-title" id="resultTitle"></div>

            <div class="result-item">
                <div class="result-label">Quality Score:</div>
                <div class="quality-score" id="qualityScore"></div>
                <div class="quality-bar">
                    <div class="quality-fill" id="qualityFill"></div>
                </div>
            </div>

            <div class="result-item">
                <div class="result-label">Analysis:</div>
                <div id="message"></div>
            </div>

            <div class="result-item" id="nistResultsContainer" style="display: none;">
                <div class="result-label">NIST Test Results:</div>
                <pre id="nistResults" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9em; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 5px; margin-top: 10px;"></pre>
            </div>
        </div>
    </div>

    <script>
        // Update input statistics in real-time
        function updateInputStats() {
            const input = document.getElementById('numbers').value;
            const numbers = input.split(/[^0-9]+/).filter(s => s.length > 0);
            const numberCount = numbers.length;
            const bitCount = numberCount * 32;

            document.getElementById('numberCount').textContent = numberCount;
            document.getElementById('bitCount').textContent = bitCount;

            // Update tier indicator and guidance
            const tierIndicator = document.getElementById('tierIndicator');
            const guidanceBox = document.getElementById('guidanceBox');
            const guidanceText = document.getElementById('guidanceText');

            // Update tier chart highlighting
            let currentTier = 0;
            if (bitCount >= 10000) currentTier = 4;
            else if (bitCount >= 4000) currentTier = 3;
            else if (bitCount >= 1000) currentTier = 2;
            else if (bitCount >= 100) currentTier = 1;
            else currentTier = 0;

            // Reset all tiers
            for (let i = 0; i <= 4; i++) {
                const tierRow = document.getElementById(`tier${i}`);
                const tierStatus = tierRow.querySelector('.tier-status');
                tierRow.classList.remove('active', 'completed');
                tierStatus.style.display = 'none';

                if (i < currentTier) {
                    tierRow.classList.add('completed');
                } else if (i === currentTier) {
                    tierRow.classList.add('active');
                    tierStatus.style.display = 'inline';
                }
            }

            if (bitCount < 100) {
                const needed = 4 - numberCount;
                tierIndicator.className = 'tier-indicator tier-insufficient';
                tierIndicator.innerHTML = `<span class="tier-label">Too Small</span><span class="tier-target">Need ${needed} more for NIST</span>`;
                guidanceBox.style.display = 'block';
                guidanceText.innerHTML = `NIST tests cannot run. <strong>Add at least ${needed} more number${needed !== 1 ? 's' : ''}</strong> to enable basic NIST testing (minimum: 4 numbers / 100 bits).`;
            } else if (bitCount < 1000) {
                const needed = 32 - numberCount;
                tierIndicator.className = 'tier-indicator tier-minimal';
                tierIndicator.innerHTML = `<span class="tier-label">Minimal Coverage</span><span class="tier-target">+${needed} for better tests</span>`;
                guidanceBox.style.display = 'block';
                guidanceText.innerHTML = `Limited NIST testing possible. <strong>Add ${needed} more numbers</strong> to reach 32 numbers (1,000 bits) for improved test coverage.`;
            } else if (bitCount < 4000) {
                const needed = 125 - numberCount;
                tierIndicator.className = 'tier-indicator tier-limited';
                tierIndicator.innerHTML = `<span class="tier-label">Partial Coverage</span><span class="tier-target">+${needed} for most tests</span>`;
                guidanceBox.style.display = 'block';
                guidanceText.innerHTML = `Some NIST tests will run. <strong>Add ${needed} more numbers</strong> to reach 125 numbers (4,000 bits) for most tests.`;
            } else if (bitCount < 10000) {
                const needed = 313 - numberCount;
                tierIndicator.className = 'tier-indicator tier-good';
                tierIndicator.innerHTML = `<span class="tier-label">Good Coverage</span><span class="tier-target">+${needed} for full suite</span>`;
                guidanceBox.style.display = 'block';
                guidanceText.innerHTML = `Most NIST tests will run. <strong>Add ${needed} more numbers</strong> to reach 313 numbers (10,000 bits) for comprehensive coverage.`;
            } else {
                tierIndicator.className = 'tier-indicator tier-excellent';
                tierIndicator.innerHTML = `<span class="tier-label">Full Coverage</span><span class="tier-target">‚úì All tests available</span>`;
                guidanceBox.style.display = 'block';
                guidanceText.innerHTML = '‚úì Comprehensive NIST statistical analysis will be performed with full test coverage.';
            }

            if (numberCount === 0) {
                guidanceBox.style.display = 'none';
            }
        }

        // Add event listener for real-time updates
        document.getElementById('numbers').addEventListener('input', updateInputStats);

        // Initialize on page load
        updateInputStats();

        document.getElementById('validationForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const numbers = document.getElementById('numbers').value;
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');

            // Show loading, hide results
            loadingDiv.style.display = 'block';
            resultsDiv.style.display = 'none';

            try {
                const response = await fetch('/api/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ numbers, use_nist: true }),
                });

                const data = await response.json();

                // Hide loading
                loadingDiv.style.display = 'none';

                // Show results
                resultsDiv.style.display = 'block';
                resultsDiv.className = data.valid ? 'valid' : 'invalid';

                document.getElementById('resultTitle').textContent =
                    data.valid ? '‚úì Valid Random Sequence' : '‚úó Poor Random Sequence';

                const scorePercent = (data.quality_score * 100).toFixed(1);
                document.getElementById('qualityScore').textContent = scorePercent + '%';
                document.getElementById('qualityFill').style.width = scorePercent + '%';

                document.getElementById('message').textContent = data.message;

                if (data.nist_results) {
                    document.getElementById('nistResultsContainer').style.display = 'block';
                    document.getElementById('nistResults').textContent = data.nist_results;
                }

            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
                resultsDiv.className = 'invalid';
                document.getElementById('resultTitle').textContent = '‚úó Error';
                document.getElementById('message').textContent = 'Failed to validate: ' + error.message;
            }
        });
    </script>

    <div class="footer">
        Version <a href="https://github.com/bottiger/randomnumbervalidator/commit/{{GIT_HASH}}" target="_blank">{{GIT_HASH}}</a>
        ({{GIT_DATE}})
    </div>
</body>
</html>
